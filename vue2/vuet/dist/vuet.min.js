!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.Vuet=t.Vuet||{})}(this,function(t){"use strict";function e(t){return Object.assign({x:0,y:0},t)}function n(t,n,r,o){var i=r.path,s=r.name,a=n.context,c=a.$vuet[p].scrolls[i];if(s&&a)return c[s]||(c[s]=e(o)),u(t,c[s]),c[s]}function r(t,e){var n=e.target,r=n.scrollTop,o=n.scrollLeft,i=n.pageXOffset,u=n.pageYOffset;t.x=o||u||o,t.y=r||i||r}function o(t,e){var n=e.path,r=e.name;if(t){var o=t.$vuet[p].scrolls[n][r];document.querySelectorAll("[data-vuet-route-scroll="+r+"]").forEach(function(t){u(t,o)})}}function i(t,e){t.x=window.pageXOffset,t.y=window.pageYOffset}function u(t,e){"scrollTop"in t&&t!==window?(t.scrollLeft=e.x,t.scrollTop=e.y):t.scrollTo(e.x,e.y)}function s(t){return!0!==t.window||t.self}function a(t){return t.window}function c(t){c.installed||(c.installed=!0,m=t,Object.defineProperty(t.prototype,"$vuet",{get:function(){return this.$root._vuet}}),t.mixin({beforeCreate:function(){_.isUndefined(this.$options.vuet)||(this._vuet=this.$options.vuet,this._vuet._init(this))},destroyed:function(){_.isUndefined(this.$options.vuet)||(this._vuet=this.$options.vuet,this._vuet.destroy(this))}}),t.directive("route-scroll",w))}function l(t,e){e.rule("life",b).rule("manual",g).rule("need",S).rule("once",O).rule("route",d)}function f(t){for(var e=A.options.rules,n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];for(var i in e)_.isFunction(e[i][t])&&e[i][t].apply(e[i],r)}var h=Object.prototype.toString,v=["Object","Function","String","Undefined","Null"],_={getArgMerge:function(){var t={},e=arguments;return _.isString(e[0])?t[e[0]]=e.length>1?e[1]:e[0]:e[0]&&_.isObject(e[0])&&(t=e[0]),t},set:function(t,e,n){Object.defineProperty(t,e,{value:n,enumerable:!1,writable:!0,configurable:!1})}};v.forEach(function(t){var e="[object "+t+"]";_["is"+t]=function(t){return h.call(t)===e}});var p="__route__",d={init:function(t){_.set(t,p,{watchers:{},scrolls:{}}),Object.keys(t.store).forEach(function(e){_.set(t[p].watchers,e,[]),_.set(t[p].scrolls,e,{})})},rule:function(t){function e(t){var e=t.$vuet;Object.keys(e[p].scrolls[a]).forEach(function(n){var r={x:0,y:0};if(e[p].scrolls[a][n]=r,"__window__"===n)return u(window,r);o(t,{path:a,name:n})})}function n(t){return t[p].watchers[a]}function r(t,e){t[p].watchers[a]=e}function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments[1];"string"==typeof e&&(e=[e]);var n=function(t,e){return e.split(".").forEach(function(e){t=t[e]}),t},r=[];return e.forEach(function(e){var o=n(t,e);isNaN(o)||(o=String(o)),r.push(JSON.stringify(o))}),r}function s(t,e){for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!0;return!1}var a=t.path;return{beforeCreate:function(){var t=this,o=this.$vuet._options.modules[a].routeWatch,u=void 0===o?"fullPath":o,c=i(this.$route,u);s(c,n(this.$vuet))&&(this.$vuet.reset(a),r(this.$vuet,c),e(this)),this.$vuet.fetch(a,{current:this},!1).then(function(e){s(c,i(t.$route,u))||(t.$vuet.setState(a,e),r(t.$vuet,c))})},watch:{$route:{deep:!0,handler:function(t,n){var o=this,u=this.$vuet._options.modules[a].routeWatch,c=void 0===u?"fullPath":u,l=i(t,c),f=i(n,c);if(!s(l,f))return!1;this.$vuet.fetch(a,{current:this}).then(function(t){s(l,i(o.$route,c))||(e(o),o.$vuet.setState(a,t),r(o.$vuet,l))})}}}}}},y={error:function(t){throw new Error("[vuet] "+t)},warn:function(t){}},w={inserted:function(t,e,u){var c=e.modifiers,l=e.value;if(s(c)){if("__window__"===l.name)return y.error("name not __window__");if(!l.name)return y.error("Name is imperative parameter");_.isObject(l.self)&&(t.__vuetRouteSelfScrolls__=l.self);var f=n(t,u,l,t.__vuetRouteScrolls__);t.dataset.vuetRouteScroll=l.name,t.__vuetRouteSelfScroll__=function(e){r(f,e),_.isObject(t.__vuetRouteSelfScrolls__)&&r(t.__vuetRouteSelfScrolls__,e),o(u.context,l)},t.addEventListener("scroll",t.__vuetRouteSelfScroll__,!1)}if(a(c)){_.isObject(l.window)&&(t.__vuetRouteWindowScrolls__=l.window);var h=n(window,u,Object.assign({},l,{name:"__window__"}),t.__vuetRouteWindowScrolls__);t.__vuetRouteWindowScroll__=function(e){i(h,e),_.isObject(t.__vuetRouteWindowScrolls__)&&i(t.__vuetRouteWindowScrolls__,e)},window.addEventListener("scroll",t.__vuetRouteWindowScroll__,!1)}},componentUpdated:function(t,e,n){var r=e.modifiers,o=e.value;s(r)&&_.isObject(o.self)&&(t.__vuetRouteSelfScrolls__=o.self,u(t,t.__vuetRouteSelfScrolls__)),a(r)&&_.isObject(o.window)&&(t.__vuetRouteWindowScrolls__=o.window,u(window,t.__vuetRouteWindowScrolls__))},unbind:function(t){"function"==typeof t.__vuetRouteSelfScroll__&&(t.removeEventListener("scroll",t.__vuetRouteSelfScroll__,!1),delete t.__vuetRouteSelfScroll__,delete t.__vuetRouteSelfScrolls__),"function"==typeof t.__vuetRouteWindowScroll__&&(window.removeEventListener("scroll",t.__vuetRouteWindowScroll__,!1),delete t.__vuetRouteWindowScroll__,delete t.__vuetRouteWindowScrolls__)}},m=null,b={rule:function(t){var e=t.path;return{beforeCreate:function(){this.$vuet.fetch(e,{current:this})},destroyed:function(){this.$vuet.reset(e,{current:this})}}}},g={rule:function(t){var e=t.path,n=t.name;return{beforeCreate:function(){var t=this,r=this.$vuet._options.modules[e].manuals,o={};if(Object.keys(r).forEach(function(n){var i=r[n];_.isFunction(i)&&(o[""+n]=function(){for(var n=arguments.length,r=Array(n),u=0;u<n;u++)r[u]=arguments[u];return i.apply(o,[{state:t.$vuet.getState(e),vm:t,vuet:t.$vuet}].concat(r))})}),o.reset=function(){for(var n,r=arguments.length,o=Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=t.$vuet).reset.apply(n,[e].concat(o))},o.fetch=function(){for(var n,r=arguments.length,o=Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=t.$vuet).fetch.apply(n,[e].concat(o))},n)this[n]=o;else if(r.name)this[r.name]=o;else{var i=e.split(this.$vuet._options.pathJoin),u="$"+i[i.length-1],s=this[u]={};Object.assign(s,o)}}}}},S={rule:function(t){var e=t.path;return{beforeCreate:function(){this.$vuet.fetch(e,{current:this})}}}},$="__once__",O={init:function(t){_.set(t,$,{}),Object.keys(t.store).forEach(function(e){_.set(t[$],e,!1)})},rule:function(t){var e=t.path;return{beforeCreate:function(){var t=this;!1===this.$vuet[$][e]&&this.$vuet.fetch(e,{current:this}).then(function(){t.$vuet[$][e]=!0})}}}},j=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},R=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),k=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},E=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},A=function(){function t(e){j(this,t),_.isObject(e)||y.error("Parameter is the object type"),this.options=e||{},this.app=null,this.store={},this.beforeHooks=[],this.afterHooks=[],this.vm=null}return R(t,[{key:"beforeEach",value:function(t){return this.beforeHooks.push(t),this}},{key:"afterEach",value:function(t){return this.afterHooks.push(t),this}},{key:"_init",value:function(t){var e=this;if(!this.app&&t){this.app=t,this.vm=new m({data:{store:this.store}}),this._options=k({data:function(){return{}},pathJoin:null},this.options,{modules:{}});var n=["data","fetch","routeWatch","manuals"],r=this._options.pathJoin;!function t(o,i){Object.keys(i).forEach(function(u){var s=i[u],a=[].concat(E(o),[u]);if(_.isFunction(s.data)){var c=null;if(r)c=a.join(r);else{c=[a[0]];for(var l=1;l<a.length;l++)c.push(a[l].replace(/^(\w)/,function(t){return t.toUpperCase()}));c=c.join("")}e._options.modules[c]=s,e.reset(c)}-1===n.indexOf(u)&&_.isObject(s)&&t(a,s)})}([],this.options.modules),f("init",this)}}},{key:"getState",value:function(t){return this.store[t]||{}}},{key:"setState",value:function(t,e){return _.isObject(e)?this.store[t]?(Object.assign(this.store[t],e),this):(m.set(this.store,t,e),this):this}},{key:"fetch",value:function(t,e,n){var r=this,o=this._options.modules[t];if(!_.isFunction(o.fetch))return Promise.resolve(this.getState(t));var i={path:t,params:k({},e),state:this.getState(t),route:this.app.$route||{}},u=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];for(var i=0;i<r[t].length;i++)if(r[t][i].apply(r,n))return!1};return!1===u("beforeHooks",i)?Promise.resolve(i.state):o.fetch.call(this,i).then(function(e){return!1===u("afterHooks",null,i,e)?i.state:!1===n?e:(r.setState(t,e),i.state)}).catch(function(t){return!1===u("afterHooks",t,i)?Promise.resolve(i.state):Promise.reject(t)})}},{key:"reset",value:function(t){var e=this._options.data.call(this),n=this._options.modules[t];return _.isFunction(n.data)&&Object.assign(e,n.data.call(this,t)),this.setState(t,e),this}},{key:"destroy",value:function(){this.vm.$destroy(),f("destroy",this)}}]),t}();Object.assign(A,{options:{rules:{}},install:c,rule:function(t,e){return this.options.rules[t]?this:(this.options.rules[t]=e,f("install",m,A),this)},mapRules:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=_.getArgMerge.apply(null,arguments),o=[],i=function(t,e){var n=A.options.rules[t];"string"==typeof e?o.push(n.rule({path:e})):o.push(n.rule(e))};return Object.keys(r).forEach(function(t){var e=r[t];if(Array.isArray(e))return e.forEach(function(e){i(t,e)});i(t,e)}),{mixins:o}},mapModules:function(){var t=_.getArgMerge.apply(null,arguments),e={};return Object.keys(t).forEach(function(n){var r=t[n];e[n]={get:function(){return this.$vuet.store[r]},set:function(t){this.$vuet.store[r]=t}}}),{computed:e}},use:function(t,e){return _.isFunction(t)?t(m,A,e):_.isFunction(t.install)&&t.install(m,A,e),this}}),A.use(l);var W=A.mapRules.bind(A),x=A.mapModules.bind(A);t.mapRules=W,t.mapModules=x,t.default=A,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=vuet.min.js.map
